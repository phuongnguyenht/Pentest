# Top 5 Intrusive Nmap Scripts Hackers & Pentesters Should Know

1. Web Application Firewall Detection
nmap -p80,443 --script http-waf-detect --script-args="http-waf-detect.aggro,http-waf-detect.detectBodyChanges" targetWebsite.com
```
Starting Nmap 7.70 ( https://nmap.org )
Nmap scan report for targetWebsite.com
Host is up (0.65s latency).

PORT    STATE SERVICE
80/tcp  open  http
| http-waf-detect: IDS/IPS/WAF detected:
|_targetWebsite.com:80/?p4yl04d=hostname%00
443/tcp open  https
| http-waf-detect: IDS/IPS/WAF detected:
|_targetWebsite.com:443/?p4yl04d=hostname%00
```

2. Web Application Firewall Fingerprint Detection
nmap -p80,443 --script http-waf-fingerprint targetWebsite.com

```
Starting Nmap 7.70 ( https://nmap.org )
Nmap scan report for targetWebsite.com
Host is up (0.71s latency).

PORT    STATE SERVICE
80/tcp  open  http
| http-waf-fingerprint:
|   Detected WAF
|_    Cloudflare
443/tcp open  https
```

```
We can further improve Nmap's ability to detect WAF types and versions using the http-waf-fingerprint.intensive argument. This will prolong the scan time and also increase the amount of noise (web traffic) generated by the script.
```
nmap -p80,443 --script http-waf-fingerprint --script-args http-waf-fingerprint.intensive=1 targetWebsite
```
Starting Nmap 7.70 ( https://nmap.org )
Nmap scan report for targetWebsite
Host is up (0.84s latency).

PORT    STATE SERVICE
80/tcp  open  http
| http-waf-fingerprint:
|   Detected WAF
|_    BinarySec version 3.4.0
443/tcp open  https
```
3. Find HTTP Errors

```
1xx (Informational): The request was received, continuing process
2xx (Successful): The request was successfully received, understood, and accepted
3xx (Redirection): Further action needs to be taken in order to complete the request
4xx (Client Error): The request contains bad syntax or cannot be fulfilled
5xx (Server Error): The server failed to fulfill an apparently valid request
```
nmap -p80,443 --script http-errors targetWebsite.com
```
Simply calling the http-errors script is enough to get started. Ports 80 and 443 are command web server ports but can be changed to meet your needs.

Nmap scan report for targetWebsite.com
Host is up (0.67s latency).

PORT    STATE SERVICE
80/tcp  open  http
| http-errors:
| Spidering limited to: maxpagecount=40; withinhost=targetWebsite.com
|   Found the following error pages:
|
|   Error Code: 403
|_  	http://targetWebsite.com:80/
443/tcp open  https
| http-errors:
| Spidering limited to: maxpagecount=40; withinhost=targetWebsite.com
|   Found the following error pages:
|
|   Error Code: 400
|_  	http://targetWebsite.com:443/
In the above output, Nmap detected a status 403, which suggests the servers file permissions are misconfigured and visitors don't have access to the requested resource. Below is a more refined command that includes several script arguments.
```
nmap -vv -p80,443 --script http-errors --script-args "httpspider.url=/docs/,httpspider.maxpagecount=3,httpspider.maxdepth=1" targetwebsite.com
```
This particular Nmap script utilizes the httpspider library, so we can use arguments like httpspider.url, httpspider.maxpagecount, and httpspider.maxdepth to refine our scan to specific URLs and define how many pages we want Nmap to crawl before stopping.
```
4. Find Shared & New Servers

```
This particular website has many subdomains configured and not all share the same IP address. At this point, a penetration tester can further expand their reconnaissance to the newly discovered servers under this websites control.

Below is a dns-brute command that features several --script-args.
```
nmap -p80,443 --script dns-brute --script-args dns-brute.threads=25,dns-brute.hostlist=/root/Desktop/custom-subdomain-wordlist.txt targetWebsite.com
```
Starting Nmap 7.70 ( https://nmap.org )
Nmap scan report for targetWebsite.com
Host is up (0.17s latency).

PORT    STATE SERVICE
80/tcp  open  http
443/tcp open  https

Host script results:
| dns-brute:
|   DNS Brute-force hostnames:
|     www7.targetWebsite.com - 198.105.244.228
|     www7.targetWebsite.com - 198.105.254.228
|     www.targetWebsite.com - 104.97.95.87
|     webdisk.test.targetWebsite.com - 198.105.244.228
|     webdisk.test.targetWebsite.com - 198.105.254.228
|     www4.targetWebsite.com - 198.105.244.228
|     www4.targetWebsite.com - 198.105.254.228
|     www1.targetWebsite.com - 198.105.244.228
|     www1.targetWebsite.com - 198.105.254.228
|     app.targetWebsite.com - 104.97.95.87
|     mail.targetWebsite.com - 98.99.254.8
|     www.m.targetWebsite.com - 198.105.244.228
|     www.m.targetWebsite.com - 198.105.254.228
|     meet.targetWebsite.com - 199.233.179.60
|     members.targetWebsite.com - 52.85.88.11
|     members.targetWebsite.com - 52.85.88.178
|     members.targetWebsite.com - 52.85.88.184
|     members.targetWebsite.com - 52.85.88.186
|     webmail2.targetWebsite.com - 198.105.244.228
|     webmail2.targetWebsite.com - 198.105.254.228
|     ww2.targetWebsite.com - 198.105.244.228
|     ww2.targetWebsite.com - 198.105.254.228
|     sip.targetWebsite.com - 199.233.179.46
|_    www.chat.targetWebsite.com - 198.105.254.228

Nmap done: 1 IP address (1 host up) scanned in 62.15 seconds
```
```
By default, dns-brute will scan using five concurrent threads. We can increase or decrease this value with the dns-brute.threads. Depending on the type of web server, many threads will crash a server or act as a denial of service, making the website slow or unresponsive for other users. Adjust this value with caution.

Dns-brute will attempt about 125 popular subdomains. We can use custom subdomain lists with the dns-brute.hostlist argument. As we can see in the above output, using a comprehensive wordlist, we were able to detect more subdomains and IP addresses controlled by this website.

Related Book: "Nmap 6: Network Exploration and Security Auditing Cookbook" by Paulino Calderon (Available from Amazon | Walmart)
```
5. Extract EXIF Data from Photos

nmap -p80,443 --script http-exif-spider targetWebsite.com
```
Starting Nmap 7.70 ( https://nmap.org )
Nmap scan report for targetWebsite.com
Host is up (0.12s latency).

PORT    STATE SERVICE
80/tcp  open  http
| http-exif-spider:
|   http://targetWebsite.com:80/image_10012.jpg
|     Make: NIKON CORPORATION
|     Model: NIKON D4
|     Date: 2017:04:26 21:22:49
|   http://targetWebsite.com:80/ips.jpg
|     Make: Samsung
|     Model: Galaxy S6
|_    Date: 2017:02:24 23:37:14
443/tcp open  https
| http-exif-spider:
|   https://targetWebsite.com:443/clifton.jpg
|     Make: Canon
|_    Model: Canon EOS 5D Mark III

Nmap done: 1 IP address (1 host up) scanned in 30.43 seconds
We can see the above target is using an Android phone and a variety of digital cameras. We can now (with some degree of certainty) generate an Android-specific payload and send it to the target to further compromise their devices, accounts, and networks.

When attempting to extract EXIF data from large photos, Nmap may produce an error message that states "Current http cache size exceeds max size." This is Nmap telling us that the photo is too large and is exceeding the default maximum file size value. Use the http.max-cache-size argument and increase the value as needed. Below I've set it to an arbitrarily high number.

nmap -p80,443 --script http-exif-spider --script-args="http.max-cache-size=99999999" targetWebsite.com
```
6. Referent: https://null-byte.wonderhowto.com/how-to/advanced-nmap-top-5-intrusive-nmap-scripts-hackers-pentesters-should-know-0187287/